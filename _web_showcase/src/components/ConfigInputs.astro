<style>
#inputs-panel {
  display: flex;
  flex-direction: column;
  align-items: start;
}

.input-wrapper {
  display: flex;
  flex-direction: column;
  width: 100%;

  input {
    width: 100%;
  }
}

@media(width >= 640px) {
  .input-wrapper{
    flex-direction: row;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
  }
}

@media(width >= 1024px) {
  #inputs-panel {
    display: grid;
    grid-template-areas: 
      "a a b b c c c c"
      "d d d d e e e e";
  }
  .input-wrapper {
    display: flex;
  }
  .input-wrapper:nth-child(1) {
    grid-area: a;
  }
  .input-wrapper:nth-child(2) {
    grid-area: b;
  }
  .input-wrapper:nth-child(3) {
    grid-area: c;
  }
  .input-wrapper:nth-child(4) {
    grid-area: d;

    label {
      margin-left: auto;
    }
  }
  .input-wrapper:nth-child(5) {
    grid-area: e;
  }
  input {
    width: unset;
    max-width: 12rem;
  }
}

</style>
<div id="inputs-panel" class="neo-border max-w-[60rem] mx-auto bg-neo-purple text-white dark:bg-neo-pink dark:text-black p-4 mb-8 gap-6 items-center shadow-lg transition-colors">
  <div class="input-wrapper col-span-3">
    <label for="lookahead-input" class="font-black uppercase text-sm whitespace-nowrap">
      Days from today:
    </label>
    <input
      type="number"
      id="lookahead-input"
      min="0"
      class="neo-input w-full py-1"
    />
  </div>
  <div class="input-wrapper col-span-3">
    <label class="font-black uppercase text-sm whitespace-nowrap">
      Limit events:
    </label>
    <input
      type="number"
      id="limit-input"
      min="0"
      class="neo-input w-full py-1"
    />
  </div>
  <div class="input-wrapper">
    <label class="font-black uppercase text-sm whitespace-nowrap">
      Template:
    </label>
    <div class="w-full lg:flex-grow flex items-center justify-end gap-2">
      <button 
        type="button" 
        id="template-help-btn"
        class="neo-button-sm aspect-square grid items-center bg-white text-black dark:bg-neo-dark dark:text-white"
        title="Template Help"
      >?</button>
      <input
        type="text"
        id="template-input"
        placeholder="Date Template"
        class="neo-input w-full py-1 min-w-0"
      />
    </div>
  </div>

  <div class="input-wrapper">
    <label class="font-black uppercase text-sm whitespace-nowrap">
      Append Today:
    </label>
    <input
      type="text"
      id="marker-today-input"
      placeholder="e.g. (TODAY)"
      class="neo-input py-1"
    />
  </div>
  <div class="input-wrapper">
    <label class="font-black uppercase text-sm whitespace-nowrap">
      Append Tomorrow:
    </label>
    <input
      type="text"
      id="marker-tomorrow-input"
      placeholder="e.g. (TOMORROW)"
      class="neo-input py-1"
    />
  </div>
</div>

<dialog id="template-help-dialog" class="neo-border neo-shadow-lg p-8 bg-white dark:bg-neo-dark text-black dark:text-white max-w-lg fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 backdrop:bg-black/70">
  <div class="flex justify-between items-start mb-6 gap-8">
    <h2 class="text-2xl font-black uppercase italic text-black dark:text-white">Date Templating</h2>
    <button id="close-help-btn" class="neo-button-sm !bg-[#dd8181] py-1 bg-neo-pink text-black">Ã—</button>
  </div>
  
  <div class="space-y-4 font-bold overflow-y-auto max-h-[60vh] pr-4">
    <div class="grid grid-cols-2 gap-2 border-b-2 border-black dark:border-white pb-2">
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">M</code> <span class="text-black dark:text-white">month (1)</span>
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">MM</code> <span class="text-black dark:text-white">month (01)</span>
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">MMM</code> <span class="text-black dark:text-white">month (Jan)</span>
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">MMMM</code> <span class="text-black dark:text-white">month (January)</span>
    </div>
    <div class="grid grid-cols-2 gap-2 border-b-2 border-black dark:border-white pb-2">
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">D</code> <span class="text-black dark:text-white">day (2)</span>
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">DD</code> <span class="text-black dark:text-white">day (02)</span>
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">DDD</code> <span class="text-black dark:text-white">day (Mon)</span>
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">DDDD</code> <span class="text-black dark:text-white">day (Monday)</span>
    </div>
    <div class="grid grid-cols-2 gap-2 border-b-2 border-black dark:border-white pb-2">
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">YY</code> <span class="text-black dark:text-white">year (06)</span>
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">YYYY</code> <span class="text-black dark:text-white">year (2006)</span>
    </div>
    <div class="grid grid-cols-2 gap-2 pb-2">
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">hh</code> <span class="text-black dark:text-white">hours (15)</span>
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">mm</code> <span class="text-black dark:text-white">minutes (04)</span>
      <code class="text-neo-purple dark:text-neo-pink font-black text-lg">ss</code> <span class="text-black dark:text-white">seconds (05)</span>
    </div>
  </div>
</dialog>

<script>
  const dialog = document.getElementById('template-help-dialog') as HTMLDialogElement;
  const openBtn = document.getElementById('template-help-btn');
  const closeBtn = document.getElementById('close-help-btn');

  const lookaheadInput = document.getElementById('lookahead-input') as HTMLInputElement;
  const limitInput = document.getElementById('limit-input') as HTMLInputElement;
  const templateInput = document.getElementById('template-input') as HTMLInputElement;
  const markerTodayInput = document.getElementById('marker-today-input') as HTMLInputElement;
  const markerTomorrowInput = document.getElementById('marker-tomorrow-input') as HTMLInputElement;

  // Persistence Key Helpers
  const LH_KEY = 'jsoon_lookahead';
  const LM_KEY = 'jsoon_limit';
  const TM_KEY = 'jsoon_template';
  const M0_KEY = 'jsoon_marker_0';
  const M1_KEY = 'jsoon_marker_1';

  // Initialize from LocalStorage
  if (lookaheadInput) lookaheadInput.value = localStorage.getItem(LH_KEY) || '7';
  if (limitInput) limitInput.value = localStorage.getItem(LM_KEY) || '0';
  if (templateInput) templateInput.value = localStorage.getItem(TM_KEY) || 'YYYY MMM DD';
  if (markerTodayInput) markerTodayInput.value = localStorage.getItem(M0_KEY) || '';
  if (markerTomorrowInput) markerTomorrowInput.value = localStorage.getItem(M1_KEY) || '';

  // Save on change with validation
  const saveWithValidation = (input: HTMLInputElement, key: string, isNumber: boolean) => {
    let val = input.value;
    if (isNumber) {
      const num = parseInt(val);
      if (isNaN(num) || num < 0) {
        val = '0';
        input.value = '0';
      }
    }
    localStorage.setItem(key, val);
  };

  lookaheadInput?.addEventListener('input', () => saveWithValidation(lookaheadInput, LH_KEY, true));
  limitInput?.addEventListener('input', () => saveWithValidation(limitInput, LM_KEY, true));
  templateInput?.addEventListener('input', () => saveWithValidation(templateInput, TM_KEY, false));
  markerTodayInput?.addEventListener('input', () => saveWithValidation(markerTodayInput, M0_KEY, false));
  markerTomorrowInput?.addEventListener('input', () => saveWithValidation(markerTomorrowInput, M1_KEY, false));

  openBtn?.addEventListener('click', () => dialog.showModal());
  closeBtn?.addEventListener('click', () => dialog.close());

  // Close on click outside
  dialog?.addEventListener('click', (e) => {
    if (e.target === dialog) dialog.close();
  });
</script>
